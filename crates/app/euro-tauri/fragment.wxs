<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
    <Fragment>
        <!-- Define LocalAppDataFolder so the linker can resolve it -->
        <DirectoryRef Id="TARGETDIR">
            <Directory Id="LocalAppDataFolder" Name="AppData">
                <Directory Id="EuroraLabsFolder" Name="Eurora Labs">
                    <Directory Id="EuroraFolder" Name="Eurora">
                        <Directory Id="ChromeFolder" Name="chrome">
                            <Component Id="ChromeNativeMessagingHostJson" Guid="8c7ca6a7-77b0-4738-aaa5-9ba9b4a509fe">
                                <File Id="ChromeNativeMessagingHostJsonFile"
                                    Name="com.eurora.app.json"
                                    Source="$(env.TAURI_HOSTS_DIR)\windows.chromium.native-messaging.json"
                                KeyPath="yes" />
                            </Component>
                            <Component Id="ChromeNativeMessaging" Guid="6adc0a23-d076-44c8-8a93-e22934856bac">
                                <File Id="ChromeNativeMessagingFile"
                                    Name="euro-native-messaging.exe"
                                    Source="$(env.TAURI_NATIVE_MESSAGING_BIN)"
                                    KeyPath="yes" />
                            </Component>
                        </Directory>

                        <Directory Id="EdgeFolder" Name="edge">
                            <Component Id="EdgeNativeMessagingHostJson" Guid="a1f3b2c4-5d6e-7f80-9a1b-2c3d4e5f6a7b">
                                <File Id="EdgeNativeMessagingHostJsonFile"
                                    Name="com.eurora.app.json"
                                    Source="$(env.TAURI_HOSTS_DIR)\windows.edge.native-messaging.json"
                                    KeyPath="yes" />
                            </Component>
                            <Component Id="EdgeNativeMessaging" Guid="b2c3d4e5-6f7a-8b9c-0d1e-2f3a4b5c6d7e">
                                <File Id="EdgeNativeMessagingFile"
                                    Name="euro-native-messaging.exe"
                                    Source="$(env.TAURI_NATIVE_MESSAGING_BIN)"
                                    KeyPath="yes" />
                            </Component>
                        </Directory>

                        <Directory Id="FirefoxFolder" Name="firefox">
                            <Component Id="FirefoxNativeMessagingHostJson" Guid="b4e02a43-35e2-4635-b980-9b87224a33b1">
                                <File Id="FirefoxNativeMessagingHostJsonFile"
                                    Name="com.eurora.app.json"
                                    Source="$(env.TAURI_HOSTS_DIR)\windows.firefox.native-messaging.json"
                                    KeyPath="yes" />
                            </Component>
                            <Component Id="FirefoxNativeMessaging" Guid="93829cc0-4c70-4684-9cab-79f0cad6ed9d">
                                <File Id="FirefoxNativeMessagingFile"
                                    Name="euro-native-messaging.exe"
                                    Source="$(env.TAURI_NATIVE_MESSAGING_BIN)"
                                    KeyPath="yes" />
                            </Component>
                        </Directory>
                    </Directory>
                </Directory>
            </Directory>
        </DirectoryRef>

        <!-- Registry entries â€” use [ChromeFolder] etc. so paths always match the actual install location -->
        <DirectoryRef Id="TARGETDIR">
            <Component Id="ChromeRegistryEntries" Guid="*">
                <RegistryKey
                Root="HKCU"
                Key="Software\Google\Chrome\NativeMessagingHosts\com.eurora.app"
                ForceCreateOnInstall="yes"
                ForceDeleteOnUninstall="yes"
                >
                    <RegistryValue
                        Type="string"
                        Value="[ChromeFolder]com.eurora.app.json"
                        KeyPath="yes"
                    />
                </RegistryKey>
            </Component>
            <Component Id="EdgeRegistryEntries" Guid="*">
                <RegistryKey
                Root="HKCU"
                Key="Software\Microsoft\Edge\NativeMessagingHosts\com.eurora.app"
                ForceCreateOnInstall="yes"
                ForceDeleteOnUninstall="yes"
                >
                    <RegistryValue
                        Type="string"
                        Value="[EdgeFolder]com.eurora.app.json"
                        KeyPath="yes"
                    />
                </RegistryKey>
            </Component>
            <Component Id="FirefoxRegistryEntries" Guid="*">
                <RegistryKey
                Root="HKCU"
                Key="Software\Mozilla\NativeMessagingHosts\com.eurora.app"
                ForceCreateOnInstall="yes"
                ForceDeleteOnUninstall="yes"
                >
                    <RegistryValue
                        Type="string"
                        Value="[FirefoxFolder]com.eurora.app.json"
                        KeyPath="yes"
                    />
                </RegistryKey>
            </Component>
        </DirectoryRef>


    </Fragment>
</Wix>
